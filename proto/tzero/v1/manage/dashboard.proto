syntax = "proto3";

package tzero.v1.manage;

import "buf/validate/validate.proto";
import "google/protobuf/timestamp.proto";
import "tzero/v1/common/common.proto";

service DashboardService {
  rpc GetVolume(GetVolumeRequest) returns (GetVolumeResponse);
  rpc GetLimits(GetLimitsRequest) returns (GetLimitsResponse);
  rpc GetPayments(GetPaymentsRequest) returns (GetPaymentsResponse);
  rpc GetSettlements(GetSettlementsRequest) returns (GetSettlementsResponse);
}

message GetVolumeRequest {

}

message GetVolumeResponse {
  repeated Volume volumes = 10;
  tzero.v1.common.Decimal total = 20;

  message Volume {
    Provider provider = 10;
    tzero.v1.common.Decimal pay_in = 20;
    tzero.v1.common.Decimal pay_out = 30;
    tzero.v1.common.Decimal total = 40;
  }
}

message GetLimitsRequest {

}

message GetLimitsResponse {
  repeated Limit limits = 10;

  message Limit {
    Provider provider = 10;
    tzero.v1.common.Decimal credit_left = 20;
    tzero.v1.common.Decimal credit_usage = 30;
    tzero.v1.common.Decimal presettlement_balance = 40;
  }
}

message GetPaymentsRequest {
  optional Page page = 10;
}

message GetPaymentsResponse {
  repeated Payment payments = 10;

  message Payment {
    uint64 id = 10;
    Type type = 20;
    Provider counterpart = 30;
    Status status = 40;
    google.protobuf.Timestamp created_at = 50;
    optional google.protobuf.Timestamp accepted_at = 60;
    optional google.protobuf.Timestamp completed_at = 70;
    tzero.v1.common.Decimal usd_volume = 80;
    // TODO:

    enum Type {
      TYPE_UNSPECIFIED = 0;
      TYPE_INITIATED = 10;
      TYPE_PAID_OUT = 20;
    }

    enum Status {
      STATUS_UNSPECIFIED = 0;
      STATUS_ACCEPTED = 10;
      STATUS_SUCCESS = 20;
      STATUS_FAILED = 30;
      STATUS_PENDING_PRE_SETTLEMENT = 40;
    }
  }
}

message GetSettlementsRequest {
  optional Page page = 10;
}

message GetSettlementsResponse {
  message Settlement {
    uint64 id = 10;
    Type type = 20;
    uint32 counterpart_id = 30;
    tzero.v1.common.Decimal usd_volume = 40;
    google.protobuf.Timestamp created_at = 50;

    enum Type {
      TYPE_UNSPECIFIED = 0;
      TYPE_SENT = 10;
      TYPE_RECEIVED = 20;
    }
  }
}

message Provider {
  uint32 id = 10;
  string name = 20;
}

message Page {
  optional uint32 page = 10;
  optional uint32 size = 20 [(buf.validate.field).int32.lt = 50]; // 10 by default
}