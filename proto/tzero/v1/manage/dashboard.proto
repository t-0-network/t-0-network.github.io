syntax = "proto3";

package tzero.v1.manage;

import "buf/validate/validate.proto";
import "google/protobuf/timestamp.proto";
import "tzero/v1/common/common.proto";

service DashboardService {
  rpc GetVolume(GetVolumeRequest) returns (GetVolumeResponse);
  rpc GetCounterparties(GetCounterpartiesRequest) returns (GetCounterpartiesResponse);
  rpc GetPayments(GetPaymentsRequest) returns (GetPaymentsResponse);
  rpc GetSettlements(GetSettlementsRequest) returns (GetSettlementsResponse);
}

message GetVolumeRequest {
  optional Page page = 10;
}

message GetVolumeResponse {
  repeated Volume volumes = 10;
  tzero.v1.common.Decimal total = 20;
  PageInfo page_info = 30;

  message Volume {
    Provider provider = 10;
    tzero.v1.common.Decimal pay_in = 20;
    tzero.v1.common.Decimal pay_out = 30;
    tzero.v1.common.Decimal total = 40;
  }
}

message GetCounterpartiesRequest {
  optional Page page = 10;
}

message GetCounterpartiesResponse {
  repeated Counterparty counterparties = 10;
  PageInfo page_info = 20;

  message Counterparty {
    Provider provider = 10;

    // When they are our creditor
    // their credit limit
    tzero.v1.common.Decimal credit_line_in = 20;
    //our debt
    tzero.v1.common.Decimal net_payable = 30;
    bool presettlement_in = 40;

    // When we are their creditor
    //our credit limit
    tzero.v1.common.Decimal credit_line_out = 50;
    //their debt
    tzero.v1.common.Decimal net_receivable = 60;
    bool presettlement_out = 70;
  }
}

message GetPaymentsRequest {
  optional Page page = 10;
}

message GetPaymentsResponse {
  repeated Payment payments = 10;
  PageInfo page_info = 20;

  message Payment {
    uint64 id = 10;
    ProviderRole provider_role = 20;
    Provider counterpart = 30;
    Status status = 40;
    google.protobuf.Timestamp created_at = 50;
    optional google.protobuf.Timestamp accepted_at = 60;
    optional google.protobuf.Timestamp completed_at = 70;
    tzero.v1.common.Decimal usd_volume = 80;
    optional tzero.v1.common.Decimal payout_amount = 90;
    string currency = 100;

    enum Status {
      STATUS_UNSPECIFIED = 0;
      STATUS_PENDING_PRE_SETTLEMENT = 10;
      STATUS_ACCEPTED = 20;
      STATUS_AML_CHECK = 30;
      STATUS_SUCCESS = 40;
      STATUS_FAILED = 50;
    }
  }
}

message GetSettlementsRequest {
  optional Page page = 10;
}

message GetSettlementsResponse {
  repeated Settlement settlements = 10;
  PageInfo page_info = 20;

  message Settlement {
    uint64 id = 10;
    ProviderRole provider_role = 20;
    Provider counterpart = 30;
    tzero.v1.common.Decimal usd_volume = 40;
    google.protobuf.Timestamp created_at = 50;
  }
}

enum ProviderRole {
  PROVIDER_ROLE_UNSPECIFIED = 0;
  // The party that initiates and sends the payment/settlement
  PROVIDER_ROLE_ORIGINATOR = 10;
  // The party that receives the payment/settlement
  PROVIDER_ROLE_BENEFICIARY = 20;
}

message Provider {
  uint32 id = 10;
  string name = 20;
}

message Page {
  optional uint32 page = 10 [
    (buf.validate.field).uint32.gte = 1
  ];
  optional uint32 size = 20 [
    (buf.validate.field).uint32.gte = 1,
    (buf.validate.field).uint32.lte = 50
  ]; // 10 by default
}

message PageInfo {
  uint32 current_page = 10;
  uint32 page_size = 20;
  bool has_next = 30;
}