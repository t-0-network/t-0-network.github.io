syntax = "proto3";

package tzero.v1.common;

import "tzero/v1/common/common.proto";
import "buf/validate/validate.proto";

enum PaymentMethodType {
  PAYMENT_METHOD_TYPE_UNSPECIFIED = 0;
  PAYMENT_METHOD_TYPE_SEPA = 10;
  PAYMENT_METHOD_TYPE_SWIFT = 20;
  PAYMENT_METHOD_TYPE_CARD = 30; // only pay in
  PAYMENT_METHOD_TYPE_STABLECOIN = 40; // only pay out
  PAYMENT_METHOD_TYPE_ACH = 50;
  PAYMENT_METHOD_TYPE_WIRE = 60;
  PAYMENT_METHOD_TYPE_FPS = 70;
  PAYMENT_METHOD_TYPE_M_PESA = 80;
  PAYMENT_METHOD_TYPE_G_CASH = 90;
  PAYMENT_METHOD_TYPE_INDIAN_BANK_TRANSFER = 100;
  PAYMENT_METHOD_TYPE_PESONET = 110;
  PAYMENT_METHOD_TYPE_INSTAPAY = 120;
  // Pakistan domestic bank transfer via IBAN
  PAYMENT_METHOD_TYPE_PAKISTAN_BANK_TRANSFER = 130;
  // Pakistan mobile wallet (JazzCash, Easypaisa, etc.) - sometimes also called ID Wallet
  PAYMENT_METHOD_TYPE_PAKISTAN_MOBILE_WALLET = 140;
  // PIX - Brazilian instant payment system
  PAYMENT_METHOD_TYPE_PIX = 150;
}

message PaymentDetails {
  oneof details {
    option (buf.validate.oneof).required = true;
    // SEPA (Single Euro Payments Area) - Euro bank transfers across European countries
    Sepa sepa = 10;

    //SWIFT (Society for Worldwide Interbank Financial Telecommunication) - International wire transfers
    // Global (200+ countries)
    Swift swift = 30;

    // Stablecoin - Cryptocurrency transfers pegged to fiat currencies
    // Global
    Stablecoin stablecoin = 40;

    // ACH (Automated Clearing House) - Electronic bank-to-bank transfers
    // United States
    Ach ach = 50;

    // Wire - Domestic electronic funds transfer
    // United States
    Wire wire = 60;

    // FPS (Faster Payments Service)
    // United Kingdom
    Fps fps = 70;

    // M-Pesa - Mobile money transfer and payment service
    // Kenya, Tanzania, Mozambique, DRC, Lesotho, Ghana, Egypt, South Africa
    MPesa mpesa = 80;

    // GCash - Mobile wallet and payment platform
    // Philippines
    GCash gcash = 90;

    // Indian Bank Transfer - Domestic electronic funds transfer (IMPS/NEFT/RTGS)
    // India
    IndianBankTransfer  indian_bank_transfer = 100;

    // PESONet - Real-time domestic payments system
    // Philippines
    Pesonet pesonet = 110;

    // Instapay - Real-time domestic payments system
    // Philippines
    Instapay instapay = 120;

    // Pakistan Bank Transfer - Domestic bank transfers using Pakistani IBAN
    // Pakistan
    PakistanBankTransfer pakistan_bank_transfer = 130;

    // Pakistan Mobile Wallet - JazzCash, Easypaisa, SadaPay, NayaPay and other wallets
    // Pakistan
    PakistanMobileWallet pakistan_mobile_wallet = 140;

    // PIX - Brazilian instant payment system
    // Brazil
    Pix pix = 150;
  };

  message Sepa {
    string iban = 20 [(buf.validate.field).string = {
      min_len: 15,
      max_len: 34,
      pattern: "^[A-Z]{2}[0-9]{2}[A-Z0-9]+$"
    }];
    string beneficiary_name = 30 [(buf.validate.field).string = {
      min_len: 1,
      max_len: 70
    }];
    string payment_reference = 40 [(buf.validate.field).string = {
      max_len: 140
    }];
  }

  message Fps {
    string sort_code = 10 [(buf.validate.field).string = {
      min_len: 6,
      max_len: 8,
      pattern: "^([0-9]{2}-[0-9]{2}-[0-9]{2}|[0-9]{6})$"
    }];
    string account_number = 20 [(buf.validate.field).string = {
      min_len: 8,
      max_len: 8,
      pattern: "^[0-9]{8}$"
    }];
    string beneficiary_name = 30 [(buf.validate.field).string = {
      min_len: 1,
      max_len: 18
    }];
    string reference = 40 [(buf.validate.field).string = {
      max_len: 18
    }];
  }

  message MPesa {
    // Phone number in international format without + sign
    // Examples: 254708374149 (Kenya), 255712345678 (Tanzania), 256712345678 (Uganda)
    // Required: Yes
    string beneficiary_phone = 10 [(buf.validate.field).string = {
      min_len: 10,
      max_len: 15,
      pattern: "^[0-9]{10,15}$"
    }];

    // Account reference (max 12 chars, alphanumeric)
    // Required: Yes
    string account_reference = 20 [(buf.validate.field).string = {
      min_len: 1,
      max_len: 12,
      pattern: "^[a-zA-Z0-9]+$"
    }];
  }

  message GCash {
    string beneficiary_name = 10 [(buf.validate.field).string = {
      min_len: 1,
      max_len: 100
    }];

    // Recipient phone
    string beneficiary_phone = 20 [(buf.validate.field).string = {
      min_len: 10,
      max_len: 20,
      pattern: "^[+]?[0-9]+$"
    }];

    string payment_reference = 30 [(buf.validate.field).string = {
      max_len: 140,
    }];

  }

  message IndianBankTransfer {

    oneof method {
      option (buf.validate.oneof).required = true;

      // 1) ACCOUNT + IFSC (NEFT/RTGS/IMPS P2A)
      AccountIFSC account_ifsc = 10;

      // 2) IMPS P2P (MOBILE + MMID)
      IMPS imps = 20;
    }

    message AccountIFSC {
      // Beneficiary bank account number
      string account_number = 10 [(buf.validate.field).string = {
        min_len: 9,
        max_len: 18,
        pattern: "^[0-9]{9,18}$"
      }];

      // IFSC code (11 characters: 4 letters + '0' + 6 alphanumeric).
      string ifsc = 20 [(buf.validate.field).string = {
        min_len: 11,
        max_len: 11,
        pattern: "^[A-Z]{4}0[A-Z0-9]{6}$"
      }];
    }

    //Method 2: IMPS P2P (Mobile + MMID)
    message IMPS {
      // Indian mobile number (10 digits, starting from 6–9).
      string beneficiary_phone = 10 [(buf.validate.field).string = {
        pattern: "^[6-9][0-9]{9}$",
        min_len: 10,
        max_len: 10
      }];

      // MMID: 7-digit Mobile Money Identifier.
      string mmid = 20 [(buf.validate.field).string = {
        pattern: "^[0-9]{7}$",
        min_len: 7,
        max_len: 7
      }];
    }

    // Beneficiary name
    string beneficiary_name = 30 [(buf.validate.field).string = {
      min_len: 1,
      max_len: 70
    }];

    // Beneficiary type
    string beneficiary_type = 40 [(buf.validate.field).string = {
      min_len: 8,
      max_len: 30
    }];

    string payment_reference = 50 [(buf.validate.field).string = {
      max_len: 140,
    }];
  }

  message Swift {
    // Beneficiary's bank SWIFT/BIC code (8 or 11 characters)
    string swift_code = 10 [(buf.validate.field).string = {
      min_len: 8,
      max_len: 11,
      pattern: "^[A-Z]{4}[A-Z]{2}[A-Z0-9]{2}([A-Z0-9]{3})?$"
    }];

    // Beneficiary's account number (format varies by country)
    // Could be IBAN, account number, or other format
    string account_number = 20 [(buf.validate.field).string = {
      min_len: 1,
      max_len: 34
    }];

    // Beneficiary's full name
    string beneficiary_name = 30 [(buf.validate.field).string = {
      min_len: 1,
      max_len: 140
    }];

    // Beneficiary's address
    string beneficiary_address = 40 [(buf.validate.field).string = {
      min_len: 1,
      max_len: 255
    }];

    string payment_reference = 50 [(buf.validate.field).string = {
      max_len: 140
    }];
  }

  message Stablecoin {
    tzero.v1.common.Blockchain blockchain = 10 [(buf.validate.field).required = true];

    tzero.v1.common.Stablecoin stablecoin = 20 [(buf.validate.field).required = true];

    string address = 30 [(buf.validate.field).string = {
      min_len: 20,
      max_len: 64,
      pattern: "^(0x)?[a-fA-F0-9]+$"
    }];
  }

  message Ach {
    string routing_number = 10 [(buf.validate.field).string = {
      min_len: 9,
      max_len: 9,
      pattern: "^[0-9]{9}$"
    }];

    string account_number = 20 [(buf.validate.field).string = {
      min_len: 1,
      max_len: 17,
      pattern: "^[0-9]+$"
    }];

    string account_holder_name = 30 [(buf.validate.field).string = {
      min_len: 1,
      max_len: 70
    }];

    AchAccountType account_type = 40 [(buf.validate.field).enum = {
      not_in: [0]
    }];

    enum AchAccountType {
      ACH_ACCOUNT_TYPE_UNSPECIFIED = 0;
      ACH_ACCOUNT_TYPE_CHECKING = 10;
      ACH_ACCOUNT_TYPE_SAVINGS = 20;
    }
  }

  message Wire {
    string bank_name = 10 [(buf.validate.field).string = {
      min_len: 1,
      max_len: 70
    }];

    string bank_address = 20 [(buf.validate.field).string = {
      min_len: 1,
      max_len: 140
    }];

    string swift_code = 30 [(buf.validate.field).string = {
      min_len: 8,
      max_len: 11,
      pattern: "^[A-Z]{6}[A-Z0-9]{2}([A-Z0-9]{3})?$"
    }];

    string account_number = 40 [(buf.validate.field).string = {
      min_len: 1,
      max_len: 34
    }];

    string beneficiary_name = 50 [(buf.validate.field).string = {
      min_len: 1,
      max_len: 70
    }];

    string beneficiary_address = 60 [(buf.validate.field).string = {
      min_len: 1,
      max_len: 140
    }];

    string wire_reference = 70 [(buf.validate.field).string = {
      max_len: 140
    }];
  }

  message Pesonet {
    //Recipient institution: receiving bank or participating non‑bank chosen from a PESONet list.
    string recipient_financial_institution = 10 [(buf.validate.field).string = {
      min_len: 1,
      max_len: 70
    }];

    //Recipient identifier:
    //Account number (some banks also allow email/mobile).
    string recipient_identifier = 20 [(buf.validate.field).string = {
      min_len: 1,
      max_len: 70
    }];

    string recipient_account_name = 30 [(buf.validate.field).string = {
      max_len: 18
    }];

    // Purpose of Transfer (Optional/Mandatory depending on bank)
    optional string purpose_of_transfer = 40 [(buf.validate.field).string = {
      max_len: 140
    }];

    // Recipient's Address/Email (Optional/Mandatory depending on bank)
    optional string recipient_address_email = 50 [(buf.validate.field).string = {
      min_len: 1,
      max_len: 512
    }];
  }

  message Instapay {
    //Recipient institution: receiving bank or e‑money issuer selected from an InstaPay list.
    string recipient_institution = 10 [(buf.validate.field).string = {
      min_len: 1,
      max_len: 70
    }];
    //Recipient identifier (one of): Account number, or Mobile number, or Email address, or QR code (scanned/uploaded “InstaPay QR”).
    string recipient_identifier = 20 [(buf.validate.field).string = {
      min_len: 1,
      max_len: 70
    }];
    //Recipient account name: the name as registered on the account or wallet (may be auto-displayed but is logically required for correct routing/confirmation).
    string recipient_account_name = 30 [(buf.validate.field).string = {
      max_len: 50
    }];

    //Purpose of Transfer (Optional/Mandatory depending on bank)
    optional string purpose_of_transfer = 40 [(buf.validate.field).string = {
      max_len: 140
    }];
  }

  // Pakistan Bank Transfer - Domestic transfers using Pakistani IBAN
  // Pakistan uses 24-character IBAN: PK + 2 check digits + 4-char bank code + 16-char account number
  message PakistanBankTransfer {
    // Pakistani IBAN (24 characters: PK + 2 check digits + 4-char bank identifier + 16-char account)
    // Example: PK36SCBL0000001123456702
    string iban = 10 [(buf.validate.field).string = {
      min_len: 24,
      max_len: 24,
      pattern: "^PK[0-9]{2}[A-Z]{4}[0-9]{16}$"
    }];

    // Beneficiary's full name
    string beneficiary_name = 20 [(buf.validate.field).string = {
      min_len: 1,
      max_len: 140
    }];

    // (Optional) Beneficiary CNIC (13 digits, no dashes) — sometimes required by receiving banks
    optional string beneficiary_cnic = 25 [(buf.validate.field).string = {
      min_len: 13,
      max_len: 13,
      pattern: "^[0-9]{13}$"
    }];

    // Payment reference/description
    string payment_reference = 30 [(buf.validate.field).string = {
      max_len: 140
    }];
  }

  // Pakistan Mobile Wallet - JazzCash, Easypaisa, SadaPay, NayaPay and other wallets
  // Transfers are made using the mobile number linked to the wallet account; CNIC is required for verification
  message PakistanMobileWallet {
    // Wallet provider
    PakistanWalletProvider wallet_provider = 10 [(buf.validate.field).enum = {not_in: [0]}];

    // Mobile number linked to the wallet (Pak local 03XXXXXXXXX or international 923XXXXXXXXX)
    string mobile_number = 20 [(buf.validate.field).string = {
      min_len: 11,
      max_len: 12,
      pattern: "^(03[0-9]{9}|923[0-9]{9})$"
    }];

    // CNIC (Computerized National Identity Card) - 13 digits without dashes
    string cnic = 30 [(buf.validate.field).string = {
      min_len: 13,
      max_len: 13,
      pattern: "^[0-9]{13}$"
    }];

    // Beneficiary's full name as registered with the wallet
    string beneficiary_name = 40 [(buf.validate.field).string = {
      min_len: 1,
      max_len: 140
    }];

    // Payment reference/description (optional)
    optional string payment_reference = 50 [(buf.validate.field).string = {
      max_len: 140
    }];

    enum PakistanWalletProvider {
      PAKISTAN_WALLET_PROVIDER_UNSPECIFIED = 0;
      PAKISTAN_WALLET_PROVIDER_JAZZCASH = 10;
      PAKISTAN_WALLET_PROVIDER_EASYPAISA = 20;
      PAKISTAN_WALLET_PROVIDER_SADAPAY = 30;
      PAKISTAN_WALLET_PROVIDER_NAYAPAY = 40;
      PAKISTAN_WALLET_PROVIDER_OTHER = 100;
    }
  }

  // PIX - Brazilian instant payment system
  // PIX allows transfers using a Pix key (CPF, CNPJ, email, phone, or random EVP)
  // or traditional bank account details (bank code, branch, account number)
  message Pix {
    // Pix key type - determines the format of pix_key_value
    KeyType key_type = 10 [(buf.validate.field).enum = {not_in: [0]}];

    // Pix key value - format depends on pix_key_type:
    // - CPF: 11 digits (e.g., "12345678901")
    // - CNPJ: 14 digits (e.g., "12345678000195")
    // - EMAIL: valid email address
    // - PHONE: international format with country code (e.g., "+5511999999999")
    // - EVP: 32-character UUID (e.g., "123e4567-e89b-12d3-a456-426614174000")
    string key_value = 20 [(buf.validate.field).string = {
      min_len: 1,
      max_len: 77
    }];

    // Beneficiary's full name
    string beneficiary_name = 30 [(buf.validate.field).string = {
      min_len: 1,
      max_len: 140
    }];

    // (Optional) Beneficiary's CPF (11 digits) or CNPJ (14 digits) for verification
    optional string beneficiary_tax_id = 40 [(buf.validate.field).string = {
      min_len: 11,
      max_len: 14,
      pattern: "^[0-9]{11,14}$"
    }];

    // (Optional) Payment description/reference
    optional string payment_reference = 50 [(buf.validate.field).string = {
      max_len: 140
    }];

    enum KeyType {
      KEY_TYPE_UNSPECIFIED = 0;
      // CPF - Cadastro de Pessoas Físicas (Individual Taxpayer Registry) - 11 digits
      KEY_TYPE_CPF = 10;
      // CNPJ - Cadastro Nacional da Pessoa Jurídica (Business Tax ID) - 14 digits
      KEY_TYPE_CNPJ = 20;
      // Email address
      KEY_TYPE_EMAIL = 30;
      // Phone number in international format
      KEY_TYPE_PHONE = 40;
      // EVP - Random key (UUID format)
      KEY_TYPE_EVP = 50;
    }
  }
}
